<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plant Breeding Tools Dashboard</title>
<!-- Auth0 SPA JS -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/latest/auth0-spa-js.production.js"></script>
<style>
/* ------------------ RESET & GLOBAL ------------------ */
* { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { min-height:100vh; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color:#fff; padding:20px; }
button { cursor:pointer; transition:0.2s; }
a { color:inherit; text-decoration:none; }
a:hover { text-decoration:underline; }

/* ------------------ HEADER ------------------ */
.header { text-align:center; margin-bottom:30px; }
.header h1 { font-size:2.5rem; margin-bottom:0.3rem; }
.header p { font-size:1rem; opacity:0.85; }
.auth-controls { margin-top:10px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
.auth-controls button { padding:8px 16px; border:none; border-radius:8px; font-weight:600; backdrop-filter:blur(5px); background:rgba(255,255,255,0.2); color:#fff; }
.auth-controls button:hover { background:rgba(255,255,255,0.35); }

/* ------------------ CONTAINER ------------------ */
.container { max-width:1400px; margin:0 auto; }
.controls { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; flex-wrap:wrap; gap:10px; }
.filter-btn { padding:8px 16px; font-size:13px; border:none; border-radius:8px; background:rgba(255,255,255,0.2); color:#fff; }
.filter-btn.active { background:rgba(255,255,255,0.4); font-weight:bold; }
.filter-btn:hover { background:rgba(255,255,255,0.35); }

/* ------------------ QUICK LINKS ------------------ */
.quick-links { backdrop-filter:blur(10px); background:rgba(255,255,255,0.15); padding:20px; border-radius:12px; margin-bottom:30px; }
.quick-links h3 { margin-bottom:15px; font-size:1.1rem; }
.links-list { display:flex; flex-wrap:wrap; gap:10px; }
.quick-link-item { display:flex; align-items:center; gap:8px; padding:8px 15px; border-radius:20px; background:rgba(255,255,255,0.2); font-size:13px; }
.quick-link-item button { background:rgba(255,255,255,0.3); border:none; border-radius:10px; padding:2px 8px; font-size:11px; color:#fff; }
.add-link-form { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; display:none; }
.add-link-form.active { display:flex; }
.add-link-form input { flex:1; padding:8px 12px; border-radius:6px; border:none; font-size:13px; }

/* ------------------ TOOL CARDS ------------------ */
.tools-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px,1fr)); gap:25px; margin-bottom:40px; }
.tool-card { background:#fff; color:#333; border-radius:12px; padding:25px; box-shadow:0 8px 25px rgba(0,0,0,0.2); transition:0.3s; position:relative; cursor:pointer; }
.tool-card:hover { transform:translateY(-5px); box-shadow:0 12px 35px rgba(0,0,0,0.3); }
.tool-card h3 { margin-bottom:8px; font-size:1.2rem; }
.tool-card p { font-size:0.85rem; color:#666; line-height:1.4; }
.tool-card .status { margin-top:12px; display:inline-block; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:bold; color:#fff; background:#4CAF50; }
.status.coming-soon { background:#FF9800; }
.tool-actions { position:absolute; top:10px; right:10px; display:flex; gap:5px; }
.tool-action-btn { width:32px; height:32px; border-radius:50%; border:none; display:flex; justify-content:center; align-items:center; font-size:16px; }
.tool-action-btn.star.active { background:#FFD700; }
.tool-card.hidden { display:none; }

/* ------------------ FAVORITES ------------------ */
#favoritesSection { margin-bottom:30px; }
#favoritesSection h3 { margin-bottom:15px; font-size:1.2rem; }

/* ------------------ FOOTER ------------------ */
.footer { text-align:center; margin-top:40px; font-size:14px; opacity:0.75; }

/* ------------------ MODALS ------------------ */
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
.modal.active { display:flex; }
.modal-content { background:#fff; color:#333; padding:30px; border-radius:15px; max-width:500px; width:90%; text-align:center; position:relative; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.modal-header h2 { font-size:1.5rem; }
.close-btn { background:none; border:none; font-size:28px; cursor:pointer; color:#999; }
.settings-section button { width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; background:#fff; transition:0.2s; }
.settings-section button:hover { background:#f5f5f5; border-color:#4CAF50; }

/* ------------------ HIDDEN TOOLS LIST ------------------ */
.hidden-tools-list { max-height:200px; overflow-y:auto; border:1px solid #ddd; border-radius:8px; padding:10px; }
.hidden-tool-item { display:flex; justify-content:space-between; align-items:center; padding:8px; margin-bottom:5px; background:#f9f9f9; border-radius:5px; }
.hidden-tool-item button { padding:4px 12px; background:#4CAF50; color:white; border:none; border-radius:5px; font-size:12px; }
#qrcodeContainer { display:flex; justify-content:center; align-items:center; min-height:256px; border:1px solid #ddd; border-radius:8px; padding:10px; }
#qrcodeContainer canvas { display:block; }
</style>
</head>
<body>

<div class="header">
    <h1>Plant Breeding Tools Dashboard</h1>
    <p>Manage your tools, favorites, hidden items, and quick links easily.</p>
    <div class="auth-controls">
        <span id="userProfile"></span>
        <button id="loginBtn" onclick="login()">Login</button>
        <button id="logoutBtn" onclick="logout()" style="display:none;">Logout</button>
    </div>
</div>

<div class="container">
    <!-- FILTER CONTROLS -->
    <div class="controls">
        <div>
            <button class="filter-btn active" onclick="filterTools('all', event)">All Tools</button>
            <button class="filter-btn" onclick="filterTools('favorites', event)">Favorites</button>
            <button class="filter-btn" onclick="filterTools('active', event)">Active Only</button>
        </div>
        <div>
            <button onclick="openSettings()">Settings</button>
            <button onclick="generateQrCode()">Generate QR Code</button>
        </div>
    </div>

    <!-- QUICK LINKS -->
    <div class="quick-links">
        <h3>Quick Links</h3>
        <div class="links-list" id="linksList"></div>
        <div id="addLinkForm" class="add-link-form">
            <input type="text" id="linkName" placeholder="Link Name">
            <input type="url" id="linkUrl" placeholder="Link URL">
            <button onclick="addQuickLink()">Add</button>
        </div>
        <button onclick="toggleAddLinkForm()">Add Quick Link</button>
    </div>

    <!-- FAVORITES -->
    <div id="favoritesSection" style="display:none;">
        <h3>Favorites</h3>
        <div class="tools-grid" id="favoritesGrid"></div>
    </div>

    <!-- ALL TOOLS -->
    <div class="tools-grid" id="toolsGrid">
        <!-- Example tools, replace with your data -->
        <div class="tool-card" data-id="tool1" data-status="active">
            <div class="tool-actions">
                <button class="tool-action-btn star" onclick="toggleFavorite(event,'tool1')">★</button>
                <button class="tool-action-btn hide" onclick="hideTool(event,'tool1')">×</button>
            </div>
            <h3>Tool 1</h3>
            <p>Description of Tool 1 goes here.</p>
            <span class="status">Active</span>
        </div>
        <div class="tool-card" data-id="tool2" data-status="coming-soon">
            <div class="tool-actions">
                <button class="tool-action-btn star" onclick="toggleFavorite(event,'tool2')">★</button>
                <button class="tool-action-btn hide" onclick="hideTool(event,'tool2')">×</button>
            </div>
            <h3>Tool 2</h3>
            <p>Description of Tool 2 goes here.</p>
            <span class="status coming-soon">Coming Soon</span>
        </div>
    </div>
</div>

<div class="footer">
    &copy; 2025 Plant Breeding Dashboard. All rights reserved.
</div>

<!-- SETTINGS MODAL -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Settings</h2>
            <button class="close-btn" onclick="closeSettings()">×</button>
        </div>
        <div class="settings-section">
            <button onclick="resetFavorites()">Reset Favorites</button>
            <button onclick="resetHidden()">Show All Hidden Tools</button>
            <button onclick="resetAll()">Reset Everything</button>
            <button onclick="exportSettings()">Export Settings</button>
            <input type="file" onchange="importSettings(event)">
        </div>
        <div class="settings-section">
            <h3>Hidden Tools</h3>
            <div class="hidden-tools-list" id="hiddenToolsList"></div>
        </div>
    </div>
</div>

<!-- QR CODE MODAL -->
<div class="modal" id="qrCodeModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>QR Code</h2>
            <button class="close-btn" onclick="closeQrCodeModal()">×</button>
        </div>
        <div id="qrcodeContainer"></div>
    </div>
</div>

<script>
/* ------------------ GLOBAL STATE ------------------ */
let auth0Client=null,currentUser=null,favorites=[],hiddenTools=[],quickLinks=[],currentFilter='all';

/* ------------------ AUTH0 INIT ------------------ */
async function initAuth0(){
    try{
        auth0Client=await createAuth0Client({
            domain:'dev-hctfmbntodg4ekwd.us.auth0.com',
            client_id:'v6yhw1p536sLDxH95gaT8DWd9KJ4nj6k',
            redirect_uri:window.location.origin,
            cacheLocation:'localStorage',
            useRefreshTokens:true
        });
        console.log('Auth0 initialized');
    }catch(err){console.error(err);alert('Failed to initialize Auth0. Check console.');return;}
    if(window.location.search.includes('code=')){
        try{await auth0Client.handleRedirectCallback();window.history.replaceState({},document.title,window.location.pathname);}catch(err){console.error('Redirect error:',err);}
    }
    updateAuthUI();
}

async function updateAuthUI(){
    const isAuthenticated=await auth0Client.isAuthenticated();
    document.getElementById('loginBtn').style.display=isAuthenticated?'none':'inline-block';
    document.getElementById('logoutBtn').style.display=isAuthenticated?'inline-block':'none';
    if(isAuthenticated){
        currentUser=await auth0Client.getUser();
        document.getElementById('userProfile').textContent=`Hello, ${currentUser.name||currentUser.email}`;
        loadUserSettings();
    }else{currentUser=null;document.getElementById('userProfile').textContent='';}
}

async function login(){if(!auth0Client)return alert('Auth not ready');try{await auth0Client.loginWithRedirect({authorizationParams:{redirect_uri:window.location.origin}});}catch(err){console.error(err);alert(err.message);}}
function logout(){if(!auth0Client)return;auth0Client.logout({logoutParams:{returnTo:window.location.origin}});currentUser=null;document.getElementById('userProfile').textContent='';document.getElementById('loginBtn').style.display='inline-block';document.getElementById('logoutBtn').style.display='none';}

/* ------------------ DASHBOARD STATE ------------------ */
function loadUserSettings(){
    favorites=JSON.parse(localStorage.getItem('favorites')||'[]');
    hiddenTools=JSON.parse(localStorage.getItem('hiddenTools')||'[]');
    quickLinks=JSON.parse(localStorage.getItem('quickLinks')||'[]');
    renderDashboard();
    renderQuickLinks();
}

function toggleFavorite(e,id){e.stopPropagation();favorites.includes(id)?favorites=favorites.filter(f=>f!==id):favorites.push(id);localStorage.setItem('favorites',JSON.stringify(favorites));renderDashboard();}
function hideTool(e,id){e.stopPropagation();if(!confirm('Hide this tool?'))return;if(!hiddenTools.includes(id))hiddenTools.push(id);localStorage.setItem('hiddenTools',JSON.stringify(hiddenTools));renderDashboard();updateHiddenToolsList();}
function showTool(id){hiddenTools=hiddenTools.filter(h=>h!==id);localStorage.setItem('hiddenTools',JSON.stringify(hiddenTools));renderDashboard();updateHiddenToolsList();}

/* ------------------ FILTERING ------------------ */
function filterTools(filter,event){currentFilter=filter;document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');applyFilter();}
function applyFilter(){const allCards=document.querySelectorAll('#toolsGrid .tool-card');const favSection=document.getElementById('favoritesSection');allCards.forEach(card=>{const id=card.dataset.id;const status=card.dataset.status;const isHidden=hiddenTools.includes(id);const isFavorite=favorites.includes(id);if(isHidden){card.style.display='none';return;}switch(currentFilter){case'all':card.style.display='block';break;case'favorites':card.style.display=isFavorite?'block':'none';favSection.style.display='none';break;case'active':card.style.display=status==='active'?'block':'none';}});}

/* ------------------ RENDERING ------------------ */
function renderDashboard(){
    const allCards=document.querySelectorAll('#toolsGrid .tool-card');
    const favGrid=document.getElementById('favoritesGrid');favGrid.innerHTML='';
    allCards.forEach(card=>{
        const id=card.dataset.id;
        const starBtn=card.querySelector('.star');
        if(favorites.includes(id)){starBtn.classList.add('active');const clone=card.cloneNode(true);clone.querySelector('.star').onclick=e=>toggleFavorite(e,id);clone.querySelector('.hide').onclick=e=>hideTool(e,id);favGrid.appendChild(clone);}else{starBtn.classList.remove('active');}
        card.classList.toggle('hidden',hiddenTools.includes(id));
    });
    document.getElementById('favoritesSection').style.display=favorites.length>0&&currentFilter!=='favorites'?'block':'none';
    applyFilter();
}

function renderQuickLinks(){
    const container=document.getElementById('linksList');container.innerHTML='';
    quickLinks.forEach((link,index)=>{
        const div=document.createElement('div');div.className='quick-link-item';
        div.innerHTML=`<a href="${link.url}" target="_blank">${link.name}</a><button onclick="removeQuickLink(${index})">×</button>`;
        container.appendChild(div);
    });
    if(quickLinks.length===0)container.innerHTML='<p style="color: rgba(255,255,255,0.7); font-size: 13px;">No quick links added yet</p>';
}

/* ------------------ QUICK LINKS ------------------ */
function toggleAddLinkForm(){const form=document.getElementById('addLinkForm');form.classList.toggle('active');if(!form.classList.contains('active')){document.getElementById('linkName').value='';document.getElementById('linkUrl').value='';}}
function addQuickLink(){const name=document.getElementById('linkName').value.trim();const url=document.getElementById('linkUrl').value.trim();if(!name||!url)return alert('Enter both name and URL');quickLinks.push({name,url});localStorage.setItem('quickLinks',JSON.stringify(quickLinks));renderQuickLinks();toggleAddLinkForm();}
function removeQuickLink(index){quickLinks.splice(index,1);localStorage.setItem('quickLinks',JSON.stringify(quickLinks));renderQuickLinks();}

/* ------------------ SETTINGS MODAL ------------------ */
function openSettings(){document.getElementById('settingsModal').classList.add('active');updateHiddenToolsList();}
function closeSettings(){document.getElementById('settingsModal').classList.remove('active');}
function updateHiddenToolsList(){const container=document.getElementById('hiddenToolsList');container.innerHTML='';if(hiddenTools.length===0){container.innerHTML='<p style="color:#999;text-align:center;">No hidden tools</p>';return;}hiddenTools.forEach(id=>{const card=document.querySelector(`[data-id="${id}"]`);const name=card?card.querySelector('h3').textContent:id;const div=document.createElement('div');div.className='hidden-tool-item';div.innerHTML=`<span>${name}</span><button onclick="showTool('${id}')">Show</button>`;container.appendChild(div);});}

/* ------------------ RESET / EXPORT / IMPORT ------------------ */
function resetFavorites(){if(confirm('Remove all favorites?')){favorites=[];localStorage.setItem('favorites',JSON.stringify(favorites));renderDashboard();}}
function resetHidden(){if(confirm('Show all hidden tools?')){hiddenTools=[];localStorage.setItem('hiddenTools',JSON.stringify(hiddenTools));renderDashboard();updateHiddenToolsList();}}
function resetAll(){if(confirm('Reset everything?')){favorites=[];hiddenTools=[];quickLinks=[];localStorage.clear();renderDashboard();renderQuickLinks();updateHiddenToolsList();}}
function getDashboardSettings(){return{favorites,hiddenTools,quickLinks,exportDate:new Date().toISOString()};}
function exportSettings(){const blob=new Blob([JSON.stringify(getDashboardSettings(),null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`breeding-tools-settings-${Date.now()}.json`;a.click();URL.revokeObjectURL(a.href);}
function importSettings(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{try{const settings=JSON.parse(e.target.result);favorites=settings.favorites||[];hiddenTools=settings.hiddenTools||[];quickLinks=settings.quickLinks||[];localStorage.setItem('favorites',JSON.stringify(favorites));localStorage.setItem('hiddenTools',JSON.stringify(hiddenTools));localStorage.setItem('quickLinks',JSON.stringify(quickLinks));renderDashboard();renderQuickLinks();updateHiddenToolsList();alert('Settings imported successfully!');}catch(err){alert('Error importing settings. Check file format.');}};reader.readAsText(file);}

/* ------------------ QR CODE ------------------ */
function generateFunctionalQrCode(containerId,data,size=256){const container=document.getElementById(containerId);container.innerHTML='';const canvas=document.createElement('canvas');canvas.width=size;canvas.height=size;const ctx=canvas.getContext('2d');ctx.fillStyle="#fff";ctx.fillRect(0,0,size,size);ctx.fillStyle="#000";ctx.font='12px Arial';ctx.textAlign='center';ctx.fillText('QR Code Placeholder',size/2,size/2);ctx.fillText(`Data length: ${data.length} bytes`,size/2,size/2+15);container.appendChild(canvas);}
function openQrCodeModal(){document.getElementById('qrCodeModal').classList.add('active');}
function closeQrCodeModal(){document.getElementById('qrCodeModal').classList.remove('active');}
function generateQrCode(){const dataUrl=window.location.href.split('?')[0]+'?import='+encodeURIComponent(JSON.stringify(getDashboardSettings()));openQrCodeModal();generateFunctionalQrCode('qrcodeContainer',dataUrl,256);}

/* ------------------ INIT ------------------ */
window.addEventListener('DOMContentLoaded',async()=>{await initAuth0();});
</script>

</body>
</html>
